<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Spin Anak Ekstra TIK</title>
<style>
body{
  font-family:Arial, sans-serif;
  background:#f2f8ff;
  text-align:center;
}
.container{
  display:flex;
  justify-content:center;
  gap:40px;
  margin-top:20px;
}
#wheel{
  border:12px solid #333;
  border-radius:50%;
}
#pointer{
  width:0;
  height:0;
  border-left:15px solid transparent;
  border-right:15px solid transparent;
  border-bottom:25px solid red;
  margin:auto;
}
button{
  margin-top:15px;
  padding:10px 25px;
  font-size:18px;
  background:#2196f3;
  color:white;
  border:none;
  border-radius:8px;
  cursor:pointer;
}
button:hover{background:#1976d2;}
.card{
  background:white;
  padding:20px;
  width:280px;
  border-radius:12px;
  box-shadow:0 2px 8px rgba(0,0,0,0.2);
  text-align:left;
}
.card h3{text-align:center;}
ul{padding-left:20px;}
</style>
</head>
<body>

<h1>ðŸŽ¯ Spin Anak Ekstra TIK SDN Karangtejo</h1>
<div id="pointer"></div>

<div class="container">

<div>
  <canvas id="wheel" width="350" height="350"></canvas><br>
  <button onclick="spin()">SPIN</button>
</div>

<div class="card">
  <h3>Sudah Terpilih</h3>
  <p><b>Kelompok:</b> <span id="kelompok">-</span></p>
  <ul id="hasil">
    <li>Belum ada</li>
  </ul>
</div>

</div>

<!-- Suara Undian -->
<audio id="spinSound" src="https://assets.mixkit.co/active_storage/sfx/2019/2019-preview.mp3"></audio>
<audio id="winSound" src="https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3"></audio>

<script>
// ================= DATA =================
const kelompokNama = "Ekstra TIK Kelas 5";

let names = [
"ALI","MUAMMAR","NITA","ROHMAD","ZULVA","HISYAM","ALDEVARO",
"ZUKY","KHANZA","GIBRAN","ZAHROTUL","AQILLA","EGA","SEFA",
"PADINI","ARU","NAZWA","ARDAN","RIFQI","LEVINIA"
];

let selected = [];

// ================= SETUP =================
const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");
const radius = canvas.width/2;
let angle = 0;
let spinning = false;

const spinSound = document.getElementById("spinSound");
const winSound = document.getElementById("winSound");

// ================= DRAW =================
function drawWheel(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  const arc = 2*Math.PI/names.length;

  names.forEach((name,i)=>{
    const start = angle + i*arc;

    ctx.beginPath();
    ctx.fillStyle = `hsl(${i*360/names.length},80%,70%)`;
    ctx.moveTo(radius,radius);
    ctx.arc(radius,radius,radius,start,start+arc);
    ctx.fill();

    // Text
    ctx.save();
    ctx.translate(radius,radius);
    ctx.rotate(start+arc/2);
    ctx.textAlign="right";
    ctx.fillStyle="#000";
    ctx.font="14px Arial";
    ctx.fillText(name, radius-10,5);
    ctx.restore();
  });
}

drawWheel();

document.getElementById("kelompok").innerText = kelompokNama;

// ================= SPIN =================
function spin(){
  if(spinning || names.length===0) return;

  spinning = true;
  spinSound.currentTime=0;
  spinSound.play();

  let speed = Math.random()*0.3+0.25;
  let decel = 0.995;

  function rotate(){
    speed *= decel;
    angle += speed;
    drawWheel();

    if(speed>0.002){
      requestAnimationFrame(rotate);
    }else{
      finishSpin();
    }
  }

  rotate();
}

// ================= RESULT =================
function finishSpin(){
  spinSound.pause();
  winSound.currentTime=0;
  winSound.play();

  const arc = 2*Math.PI/names.length;
  let index = Math.floor((2*Math.PI-angle%(2*Math.PI))/arc)%names.length;

  const winner = names[index];

  selected.push(winner);
  names.splice(index,1);

  updateList();
  drawWheel();

  spinning=false;
}

// ================= UPDATE LIST =================
function updateList(){
  const ul = document.getElementById("hasil");
  ul.innerHTML="";

  if(selected.length===0){
    ul.innerHTML="<li>Belum ada</li>";
    return;
  }

  selected.forEach((n,i)=>{
    const li=document.createElement("li");
    li.innerText = (i+1)+". "+n;
    ul.appendChild(li);
  });
}

// ================= RESET ON REFRESH =================
window.onbeforeunload = function(){
  return null;
}
</script>

</body>
</html>
